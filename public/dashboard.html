<!DOCTYPE html>
<html>
<head>
    <title>Casino Fictif</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>üé∞ Casino Fictif</h1>

    <div class="container">
        <h2 id="welcome"></h2>
        <div class="balance">
            Solde : <span id="balance">0</span> ‚Ç¨
        </div>

        <div class="slot-machine">
            <div class="reel" id="reel1">üçí</div>
            <div class="reel" id="reel2">üçã</div>
            <div class="reel" id="reel3">üçÄ</div>
        </div>

        <button onclick="play()">Jouer 10‚Ç¨</button>
        <br><br>
        <button onclick="bonus()">Bonus quotidien</button>
        <br><br>
        <button onclick="logout()">D√©connexion</button>

        <p id="result"></p>
    </div>

<script>
const user = JSON.parse(localStorage.getItem("user"));

if (!user) {
    window.location.href = "/login.html";
}

document.getElementById("welcome").innerText = "Bienvenue " + user.email;
document.getElementById("balance").innerText = user.balance;

async function play() {

    const symbols = ["üçí", "üçã", "üçÄ", "üíé", "ü™ô"];

    // Animation visuelle des rouleaux
    document.getElementById("reel1").innerText = symbols[Math.floor(Math.random()*symbols.length)];
    document.getElementById("reel2").innerText = symbols[Math.floor(Math.random()*symbols.length)];
    document.getElementById("reel3").innerText = symbols[Math.floor(Math.random()*symbols.length)];

    const response = await fetch("/play", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: user.email })
    });

    const data = await response.json();

    document.getElementById("result").innerText = data.message;
    document.getElementById("balance").innerText = data.balance;

    localStorage.setItem("user", JSON.stringify({
        email: user.email,
        balance: data.balance
    }));
}

async function bonus() {
    const response = await fetch("/bonus", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: user.email })
    });

    const data = await response.json();

    document.getElementById("result").innerText = data.message;
    document.getElementById("balance").innerText = data.balance;

    localStorage.setItem("user", JSON.stringify({
        email: user.email,
        balance: data.balance
    }));
}

function logout() {
    localStorage.removeItem("user");
    window.location.href = "/login.html";
}
</script>

</body>
</html>
