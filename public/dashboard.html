<!DOCTYPE html>
<html>
<head>
    <title>Casino-Fatal-Gain</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>üé∞ Casino-Fatal-Gain</h1>

    <div class="container">
        <h2 id="welcome"></h2>
        <div class="balance">
            Solde : <span id="balance">0</span> ‚Ç¨
        </div>

        <div class="slot-machine">
            <div class="reel" id="reel1">üçí</div>
            <div class="reel" id="reel2">üçã</div>
            <div class="reel" id="reel3">üçÄ</div>
        </div>

        <button onclick="play()">Jouer 10‚Ç¨</button>
        <br><br>
        <button onclick="bonus()">Bonus quotidien</button>
        <br><br>
        <button onclick="logout()">D√©connexion</button>

        <p id="result"></p>
    </div>

<script>
const user = JSON.parse(localStorage.getItem("user"));

if (!user) {
    window.location.href = "/login.html";
}

document.getElementById("welcome").innerText = "Bienvenue " + user.email;
document.getElementById("balance").innerText = user.balance;

async function play() {

    const symbols = ["üçí", "üçã", "üçÄ", "üíé", "ü™ô"];

    const reel1 = document.getElementById("reel1");
    const reel2 = document.getElementById("reel2");
    const reel3 = document.getElementById("reel3");

    // Ajouter animation
    reel1.classList.add("spinning");
    reel2.classList.add("spinning");
    reel3.classList.add("spinning");

    // Animation pendant 1 seconde
    let spinInterval = setInterval(() => {
        reel1.innerText = symbols[Math.floor(Math.random()*symbols.length)];
        reel2.innerText = symbols[Math.floor(Math.random()*symbols.length)];
        reel3.innerText = symbols[Math.floor(Math.random()*symbols.length)];
    }, 100);

    // Arr√™t progressif
    setTimeout(async () => {

        clearInterval(spinInterval);

        reel1.classList.remove("spinning");
        reel2.classList.remove("spinning");
        reel3.classList.remove("spinning");

        const response = await fetch("/play", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ email: user.email })
        });

        const data = await response.json();

        document.getElementById("result").innerText = data.message;
        document.getElementById("balance").innerText = data.balance;

        localStorage.setItem("user", JSON.stringify({
            email: user.email,
            balance: data.balance
        }));

    }, 1000);
}


async function bonus() {
    const response = await fetch("/bonus", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ email: user.email })
    });

    const data = await response.json();

    document.getElementById("result").innerText = data.message;
    document.getElementById("balance").innerText = data.balance;

    localStorage.setItem("user", JSON.stringify({
        email: user.email,
        balance: data.balance
    }));
}

function logout() {
    localStorage.removeItem("user");
    window.location.href = "/login.html";
}
</script>

</body>
</html>
